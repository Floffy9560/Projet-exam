<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inscription/connexion</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="assets/css/headerFooter.css" />
    <link rel="stylesheet" href="assets/css/inscription.css" />
  </head>

  <body>
    <!-- ------------------------------------------------------>
    <!--------------- formulaire d'inscription----------------->
    <!-- ------------------------------------------------------>

    <main>
      <div class="formulaire">
        <div class="connection">
          <h2>Déja client ?</h2>

          <!-- ----------------------------------------------------------------------------------------->
          <!-- ------------------ Si client : proposer de rentré ses identifiant------------------------>
          <!-- ----------------------------------------------------------------------------------------->

          <form action="account.php" method="post" target="_blank">
            <div class="form_connection">
              <label for="currentMail"></label>
              <input
                type="email"
                id="currentMail"
                name="currentMail"
                placeholder="Adresse mail"
                class="input"
                required
              />

              <label for="currentPassword"></label>
              <input
                type="current-password"
                id="currentPassword"
                name="currentPassword"
                placeholder="Mot de passe"
                class="input"
                required
              />
            </div>

            <a href="#" id="passwordLost">Mot de passe oublié?</a>

            <div class="button">
              <button type="submit" class="btnSubmit" id="SubmitCustomer">
                Se connecter
              </button>
            </div>
          </form>
        </div>
      </div>
    </main>

    <script>
      const emailRegex = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{1,}$/i; //Liens utiles pour la signification des symboles regex : https://www.tutos.eu/8752

      const currentPasswordRegex =
        /^(?=.*[A-Za-z])(?=.*\d)(?=.*[&-+!*$@%_])([&-+!*$@%_\w]{8,15})$/;

      const btnSubmitCustomer = document.getElementById("SubmitCustomer");
      console.log(btnSubmitCustomer);

      const regExCurrentMail = document.querySelector("#currentMail");
      console.log(regExCurrentMail);

      let regExCurrentPassword = document.getElementById("currentPassword");
      console.log(regExCurrentPassword);

      btnSubmitCustomer.addEventListener("click", () => {
        const currentMailValue = regExCurrentMail.value;
        const currentPasswordValue = regExCurrentPassword.value;

        if (
          emailRegex.test(currentMailValue) &&
          currentPasswordRegex.test(currentPasswordValue)
        ) {
          const data = {
            email: currentMailValue,
            password: currentPasswordValue,
          };
          // Construction des paramètres
          let url =
            "http://127.0.0.1/edsa-la-lunetterie-Senlisienne/account.php";
          url.searchParams.append("nom", data.nom);
          url.searchParams.append("email", data.email);
          // Redirection vers la nouvelle page
          window.location.href = url;
        } else {
          console.log("password invalide !");
        }
      });
    </script>
  </body>
</html>
